<html manifest="keep.appcache">
<head>
<style>
	.ui-autocomplete
		{
			max-height:200px;
			margin:0px;
			padding:0 0 0 0;
			overflow-y: auto;
			overflow-x: hidden;
			list-style-type: none;
			background-color: #F2F2F2;
			width:250px;
			font-size:16px;
			font-family: arial;
		}
	.ui-autocomplete a
		{
			padding:5 0 5 10;display: block;
		}
	.ui-autocomplete a.ui-state-focus {background-color: #C1CDCD;cursor:default}

	.mainField{
			float: left;
			margin: 0;
			border: 0px solid;
			background-color:#F2F2F2;
			height: 35px;
			width: 175px; 
			padding: 10px;
			font-size: 16px}
	textarea:focus, input:focus{outline: 0;}
	input::-webkit-input-placeholder {font-size: 16px}
	.historyTable{width:1135px;position:absolute;background-color:#CEECF5}
</style>
<!--<link rel="stylesheet" type="text/css" href="stylesheets/datepicker.css">-->
<!--<link rel="stylesheet" type="text/css" href="javascripts/Zebra_Datepicker-master/public/css/default.css">-->
</head>
<body>
	<div style="position: absolute; top:40px; left:40px;"><input type="text" id="datepicker"></div>
	<div style="position: absolute; top:100px; left:40px;"> 
		<div style="float:left">
			<form id="theForm">
			<input type="text" class="mainField" id="project" placeholder="Project">
			<input type="text" class="mainField" id="task" placeholder="Task">
			<input type="text" class="mainField" id="subtask" placeholder="Subtask">
			<input type="text" class="mainField" id="skill" placeholder="Skill">
			<input type="text" class="mainField" id="phase" placeholder="Phase">
			<input type="text" class="mainField" id="category" placeholder="Category">
			<input type="text" class="mainField" id="timer" style="width:80px" placeholder="Duration">
			</form>
		</div>
		<div style="float:right;padding:0px 0px 0px 10px;">
			<a href="#"><img src="images/startClock.jpg" id="clock" data-state="start" height="35px" width="35px" border="0"></a>	
			<img id="billing" src="images/billable1.jpg" height="35px" width="35px" onclick=changeIcon()></img>
		</div>
		<div style="position: absolute; top:60px; left:1100px;">
			<select>
			  <option>Coimbatore</option>
			  <option>Bangalore</option>
			  <option>Home</option>
			  <option>Onsite</option>
			</select>
		</div>
	</div>
	<div id="history" style="position: absolute; top:200px; left:40px;">History</div>
<script type="text/javascript" src="javascripts/jquery-1.11.1.js"></script>
<script type="text/javascript" src="javascripts/jquery-ui.js"></script>
<!--<script type="text/javascript" src="javascripts/Zebra_Datepicker-master/public/javascript/zebra_datepicker.js"></script>-->
<script>
var seconds=0,minutes=0,hours=0;
var timer = null;
var dates = [];

var projects = new Object();
function Task(skill,phase,category) { //Create new Task object
	this.skill = [skill],
	this.phase = [phase],
	this.category = [category];
}
projects["TI_HSP"] = {"General customer meeting": new Task("LabView","Requirements gathering","Project/deliverable")};
projects["TI_HSP"]["General customer meeting"]["skill"].push("Python");	
projects["TI_MSA"] = {"JIRA bugs fixing": new Task("C++","Development","Project/deliverable")};
projects["TI_MSA"]["JIRA bugs fixing"]["skill"].push("C#");

function tictac() {
	seconds++;
	if(seconds/60==1) {
		minutes++;
		seconds=0;
	}
	if(minutes/60==1) {
		hours++;
		minutes=0;
	}
	p_seconds=seconds;
	p_minutes=minutes;
	if(p_seconds<10) {p_seconds='0'+p_seconds;}
	if(p_minutes<10) {p_minutes='0'+p_minutes;}
	//$("#timer").val(hours + ":" + p_minutes + ":" + p_seconds)
	var select = 0;
	if( window.getSelection().toString() != "" && $("#timer").is(':focus') ) {
		select = 1;
	}
	if(minutes == 0 && hours == 0) {
		$("#timer").val(seconds+" sec");
	}
	else if(hours == 0 & minutes !=0 ) {
		$("#timer").val(minutes+":"+p_seconds+" min");
	}
	else if(hours != 0) {
		$("#timer").val(hours+":"+p_minutes+":"+p_seconds+" hr");
	}
	if(select == 1) {
		$("#timer").select();
	}
}
	
function reset() {
	clearInterval(timer);
    counter=0;
}
	
function startInterval() {
	timer= setInterval("tictac()", 1000);
}
	
function stopInterval() {
	clearInterval(timer);
}

function readValues() { //When the log button is clicked
	if ($("#project").val() in projects) { //If the project already exists
		if ($("#task").val() in projects[$("#project").val()]) { //If the task already exists
			//if (!($("#skill").val() in projects[$("#project").val()][$("#task").val()]["skill"])) { //If the skill is not present in the list
			if ($.inArray($("#skill").val(), projects[$("#project").val()][$("#task").val()]["skill"]) == -1) {
				projects[$("#project").val()][$("#task").val()]["skill"].push($("#skill").val($("#skill").val()));
			}
			if ($.inArray($("#phase").val(), projects[$("#project").val()][$("#task").val()]["phase"]) == -1) { //If the phase is not present in the list
				projects[$("#project").val()][$("#task").val()]["phase"].push($("#phase").val());
			}
			if ($.inArray($("#category").val(), projects[$("#project").val()][$("#task").val()]["category"]) == -1) { //If the category is not present in the list
				projects[$("#project").val()][$("#task").val()]["category"].push($("#category").val());
			}
		}
		else { //If the task is not present
			projects[$("#project").val()][$("#task").val()] = new Task($("#skill").val(),$("#phase").val(),$("#category").val());
		}
	}
	else { //If the project does not exist
		projects[$("#project").val()] = new Object();
		projects[$("#project").val()][$("#task").val()] = new Task($("#skill").val(),$("#phase").val(),$("#category").val());
	}
}

$(function () {
	//$('#datepicker').datepicker().datepicker("setDate", new Date());
	//$('#datepicker').Zebra_DatePicker();
	$("#datepicker").datepicker({
        dateFormat: "dd-mm-yy"
    }).datepicker("setDate", "0");
	
	$('#project').focus(); //Make this work!
    $('#project').autocomplete({ //project field autocomplete
        source: function (request, response) {
            var source = Object.getOwnPropertyNames(projects);
			var term = $.ui.autocomplete.escapeRegex(request.term)
              , startsWithMatcher = new RegExp("^" + term, "i")
              , startsWith = $.grep(source, function(value) {
                    return startsWithMatcher.test(value.label || value.value || value);
                })
              , containsMatcher = new RegExp(term, "i")
              , contains = $.grep(source, function (value) {
                    return $.inArray(value, startsWith) < 0 && 
                        containsMatcher.test(value.label || value.value || value);
                });
            response(startsWith.concat(contains));
        },
        minLength: 0,
        messages: {
            noResults: '',
            results: function () {}
        },
        autoFocus: true,
        open: function( event, ui ) {
                $('.ui-autocomplete > li:first-child a').addClass('ui-state-focus first_open');
        },
        focus: function( event, ui ) {            
            if(ui.item.value != $('.ui-state-focus').text()) {
                $('.first_open').removeClass('ui-state-focus first_open');
            }                    
		},   
		select: function( event, ui) {
			$("#project").val(ui.item.value);
			$("#task").focus();
		}
    }).hover(function(event) {
		$(this).focus();
		$(this).autocomplete("search", "");
	});
	$('#project').focus(function(event) {
		$(this).autocomplete("search", "");
	});
	//$("ul.ui-autocomplete").appendTo($("div#hoverMe"))
	//$('#project').on('mouseover',function(event){$(this).focus()})
	
	$('#task').autocomplete({ //task field autocomplete
        source: function (request, response) {
			var source = Object.getOwnPropertyNames(projects[$("#project").val()]);
			var term = $.ui.autocomplete.escapeRegex(request.term)
              , startsWithMatcher = new RegExp("^" + term, "i")
              , startsWith = $.grep(source, function(value) {
                    return startsWithMatcher.test(value.label || value.value || value);
                })
              , containsMatcher = new RegExp(term, "i")
              , contains = $.grep(source, function (value) {
                    return $.inArray(value, startsWith) < 0 && 
                        containsMatcher.test(value.label || value.value || value);
                });
            response(startsWith.concat(contains));
        },
        minLength: 0,
        messages: {
            noResults: '',
            results: function () {}
        },
        autoFocus: true,
        open: function( event, ui ) {
                $('.ui-autocomplete > li:first-child a').addClass('ui-state-focus first_open');
        },
        focus: function( event, ui ) {            
            if(ui.item.value != $('.ui-state-focus').text()){
                $('.first_open').removeClass('ui-state-focus first_open');
            }                                  
		},
		select: function( event, ui) {
			$("#task").val(ui.item.value);
			$("#subtask").focus();
		}		
    }).hover(function(event) {
		$(this).focus();
		$(this).autocomplete("search", "");
    });
	$('#task').focus(function(event) {
		$(this).autocomplete("search", "");
	});
	
	$('#skill').autocomplete({ //skill field autocomplete
        source: function (request, response) {
			var source = projects[$("#project").val()][$("#task").val()]["skill"];
			var term = $.ui.autocomplete.escapeRegex(request.term)
              , startsWithMatcher = new RegExp("^" + term, "i")
              , startsWith = $.grep(source, function(value) {
                    return startsWithMatcher.test(value.label || value.value || value);
                })
              , containsMatcher = new RegExp(term, "i")
              , contains = $.grep(source, function (value) {
                    return $.inArray(value, startsWith) < 0 && 
                        containsMatcher.test(value.label || value.value || value);
                });
            response(startsWith.concat(contains));
        },
        minLength: 0,
        messages: {
            noResults: '',
            results: function () {}
        },
        autoFocus: true,
        open: function( event, ui ) {
                $('.ui-autocomplete > li:first-child a').addClass('ui-state-focus first_open');
        },
        focus: function( event, ui ) {            
            if(ui.item.value != $('.ui-state-focus').text()){
                $('.first_open').removeClass('ui-state-focus first_open');
            }                           
		},
		select: function( event, ui) {
			$("#skill").val(ui.item.value);
			$("#phase").focus();
		}		
    }).hover(function(event) {
		$(this).focus();
		$(this).autocomplete("search", "");
    });
	$('#skill').focus(function(event) {
		$(this).autocomplete("search", "");
	});

	$('#phase').autocomplete({ //phase field autocomplete
        source: function (request, response) {
			var source = projects[$("#project").val()][$("#task").val()]["phase"];
			var term = $.ui.autocomplete.escapeRegex(request.term)
              , startsWithMatcher = new RegExp("^" + term, "i")
              , startsWith = $.grep(source, function(value) {
                    return startsWithMatcher.test(value.label || value.value || value);
                })
              , containsMatcher = new RegExp(term, "i")
              , contains = $.grep(source, function (value) {
                    return $.inArray(value, startsWith) < 0 && 
                        containsMatcher.test(value.label || value.value || value);
                });
            response(startsWith.concat(contains));
        },
        minLength: 0,
        messages: {
            noResults: '',
            results: function () {}
        },
        autoFocus: true,
        open: function( event, ui ) {
                $('.ui-autocomplete > li:first-child a').addClass('ui-state-focus first_open');
        },
        focus: function( event, ui ) {            
            if(ui.item.value != $('.ui-state-focus').text()){
                $('.first_open').removeClass('ui-state-focus first_open');
            }                         
		},
		select: function( event, ui) {
			$("#phase").val(ui.item.value);
			$("#category").focus();
		}		
    }).hover(function(event) {
		$(this).focus();
		$(this).autocomplete("search", "");
    });
	$('#phase').focus(function(event) {
		$(this).autocomplete("search", "");
	});
	
	$('#category').autocomplete({ //category field autocomplete
        source: function (request, response) {
			var source = projects[$("#project").val()][$("#task").val()]["category"];
			var term = $.ui.autocomplete.escapeRegex(request.term)
              , startsWithMatcher = new RegExp("^" + term, "i")
              , startsWith = $.grep(source, function(value) {
                    return startsWithMatcher.test(value.label || value.value || value);
                })
              , containsMatcher = new RegExp(term, "i")
              , contains = $.grep(source, function (value) {
                    return $.inArray(value, startsWith) < 0 && 
                        containsMatcher.test(value.label || value.value || value);
                });
            response(startsWith.concat(contains));
        },
        minLength: 0,
        messages: {
            noResults: '',
            results: function () {}
        },
        autoFocus: true,
        open: function( event, ui ) {
                $('.ui-autocomplete > li:first-child a').addClass('ui-state-focus first_open');
        },
        focus: function( event, ui ) {            
            if(ui.item.value != $('.ui-state-focus').text()){
                $('.first_open').removeClass('ui-state-focus first_open');
            }                    
		},
		select: function( event, ui) {
			$("#category").val(ui.item.value);
			$("#timer").focus();
		}		
    }).hover(function(event) {
		$(this).focus();
		$(this).autocomplete("search", "");
    });
	$('#category').focus(function(event) {
		$(this).autocomplete("search", "");
	});
	
	$("#clock").click(function() {
		if($("#clock").attr("data-state")=="start") {
			startInterval();
			$("#clock").attr({"data-state":"stop",src:"images/stopClock.jpg"});
		}
		else if($("#clock").attr("data-state")=="stop") { //Stopping the timer
			//handle transition of log to history
			stopInterval();
			readValues();
			if($("#datepicker").val() in dates) {
				$("#"+$("#datepicker").val()).append('<tr><td>'+$("#project").val()+'</td><td>'+$("#task").val()+'</td><td>'+$("#timer").val()+'</td><td>'+$("#skill").val()+"</td><td>"+$("#phase").val()+"</td></tr>");
			}
			else {
				dates.push($("#datepicker").val());
				$("#history").append("<div>"+$("#datepicker").val()+"</div>");
				$("#history").append("<table id="+$("#datepicker").val()+" class=historyTable></table>");
				$("#"+$("#datepicker").val()).append('<tr><td>'+$("#project").val()+'</td><td>'+$("#task").val()+'</td><td>'+$("#timer").val()+'</td><td>'+$("#skill").val()+"</td><td>"+$("#phase").val()+"</td></tr>");
			}
			$("#theForm")[0].reset(); //Reset the fields
			$("#clock").attr({"data-state":"start",src:"images/startClock.jpg"});
		}
		else { //Manual entry
			//handle transition of log to history
			$("#clock").attr({"data-state":"start",src:"images/startClock.jpg"});
			var duration = $("#timer").val();
			$("#todayTable").append('<tr><td>'+$("#project").val()+'</td><td>'+$("#task").val()+'</td><td>'+$("#timer").val()+'</td><td>'+$("#skill").val()+"</td><td>"+$("#phase").val()+"</td></tr>");
			$("#theForm")[0].reset(); 
		}
	})

	$("#timer").click(function() {
		$(this).select();
	})
	
	$("#timer").keyup(function () {
		stopInterval();
		if($("#timer").val() == "") {
			$("#clock").attr({"data-state":"start",src:"images/startClock.jpg"});
		}
		else {
			$("#clock").attr({"data-state":"enter",src:"images/enter.jpg"});
		}
	})
});
	
</script>
</body>
</html>